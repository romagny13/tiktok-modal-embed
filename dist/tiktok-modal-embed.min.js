class TikTokAPIService{constructor(){this.isLoaded=false;this.loadPromise=null}load(){if(this.isLoaded){return Promise.resolve()}if(this.loadPromise){return this.loadPromise}this.loadPromise=new Promise(((resolve,reject)=>{if(window.Tiktok&&window.Tiktok.Player){this.isLoaded=true;resolve();return}const script=document.createElement("script");script.src="https://www.tiktok.com/embed.js";script.onload=()=>this._waitForTikTokAPI(resolve);script.onerror=err=>reject(err);document.body.appendChild(script)}));return this.loadPromise}_waitForTikTokAPI(resolve){const checkInterval=setInterval((()=>{if(window.Tiktok&&window.Tiktok.Player){clearInterval(checkInterval);this.isLoaded=true;resolve()}}),100);setTimeout((()=>{if(!this.isLoaded){clearInterval(checkInterval);console.warn("TikTok API loading timeout");resolve()}}),5e3)}}class TikTokPlayerService{constructor(apiService){this.apiService=apiService;this.activePlayer=null;this.activeTarget=null;this.activeVideoId=null}createPlayer(videoUrl,targetElement,options={}){const videoId=this._getVideoId(videoUrl);if(!videoId){return Promise.reject(new Error("ID vidéo TikTok invalide"))}if(options.clearTarget){this.clearTarget(targetElement)}this.activeTarget=targetElement;this.activeVideoId=videoId;const embed=document.createElement("blockquote");embed.className="tiktok-embed";embed.setAttribute("cite",videoUrl);embed.setAttribute("data-video-id",videoId);const width=options.width||"325px";const minWidth=options.minWidth||"325px";embed.style.maxWidth=width;embed.style.minWidth=minWidth;const section=document.createElement("section");embed.appendChild(section);targetElement.appendChild(embed);this.activePlayer=embed;return this.apiService.load().then((()=>{if(window.Tiktok&&window.Tiktok.Embed&&typeof window.Tiktok.Embed.embedTikTokElements==="function"){window.Tiktok.Embed.embedTikTokElements()}else{this._retryEmbedTikTok()}return embed})).catch((error=>{console.error("Erreur lors du chargement de l'API TikTok:",error);throw error}))}_retryEmbedTikTok(maxRetries=5,delay=500){let attempt=0;const tryEmbed=()=>{if(window.Tiktok&&window.Tiktok.Embed&&typeof window.Tiktok.Embed.embedTikTokElements==="function"){window.Tiktok.Embed.embedTikTokElements();return true}return false};const attemptWithTimeout=()=>{if(attempt>=maxRetries)return;if(!tryEmbed()){attempt++;setTimeout(attemptWithTimeout,delay)}};attemptWithTimeout()}clearTarget(targetElement){if(!targetElement)return;while(targetElement.firstChild){targetElement.removeChild(targetElement.firstChild)}if(this.activeTarget===targetElement){this.activePlayer=null;this.activeVideoId=null}}_getVideoId(url){const match=url.match(/\/video\/(\d+)/);return match?match[1]:null}getActivePlayerInfo(){return{player:this.activePlayer,target:this.activeTarget,videoId:this.activeVideoId}}}class ModalService{constructor(playerService){this.playerService=playerService;this.activeModal=null;this.modalContainer=null;this._ensureModalStyles()}createModal(options={}){const modal=document.createElement("div");modal.className="tiktok-modal";const content=document.createElement("div");content.className="tiktok-modal-content";const closeButton=document.createElement("button");closeButton.className="tiktok-close-button";closeButton.innerHTML='<i class="fas fa-times"></i>';const container=document.createElement("div");container.className="tiktok-embed-container";content.appendChild(closeButton);content.appendChild(container);modal.appendChild(content);closeButton.addEventListener("click",(()=>this.closeModal(modal)));modal.addEventListener("click",(e=>{if(e.target===modal){this.closeModal(modal)}}));document.body.appendChild(modal);return modal}openModal(videoUrl,modal,options={}){if(!modal){modal=this.createModal(options)}modal.classList.add("active");document.body.style.overflow="hidden";this.activeModal=modal;const container=modal.querySelector(".tiktok-embed-container");return this.playerService.createPlayer(videoUrl,container,{clearTarget:true,...options})}closeModal(modal){if(!modal){if(this.activeModal){modal=this.activeModal}else{return}}modal.classList.remove("active");document.body.style.overflow="";const container=modal.querySelector(".tiktok-embed-container");this.playerService.clearTarget(container);if(this.activeModal===modal){this.activeModal=null}}_ensureModalStyles(){if(document.getElementById("tiktok-embed-styles"))return;const style=document.createElement("style");style.id="tiktok-embed-styles";style.innerHTML=`\n/* Styles du conteneur principal */\n.tiktok-wrapper {\nmax-width: 1200px;\nmargin: 0 auto;\n}\n\n/* Styles pour le plugin TikTok */\n.tiktok-embed-wrapper {\ndisplay: inline-block;\nposition: relative;\n}\n\n.tiktok-preview-button {\ndisplay: inline-flex;\nalign-items: center;\ngap: 12px;\npadding: 16px 28px;\nbackground: linear-gradient(45deg, #f8bbd0, #bbdefb);\nfont-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\ncolor: white;\nborder-radius: 12px;\ncursor: pointer;\nborder: none;\nfont-size: 16px;\nfont-weight: 600;\nbox-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);\ntransition: all 0.3s ease;\nposition: relative;\noverflow: hidden;\n}\n\n.tiktok-preview-button::before {\ncontent: "";\nposition: absolute;\ntop: 0;\nleft: -100%;\nwidth: 100%;\nheight: 100%;\nbackground: linear-gradient(\n  120deg,\n  transparent,\n  rgba(255, 255, 255, 0.3),\n  transparent\n);\ntransition: 0.5s;\n}\n\n.tiktok-preview-button:hover::before {\nleft: 100%;\n}\n\n.tiktok-preview-button:hover {\ntransform: translateY(-2px);\nbox-shadow: 0 6px 25px rgba(0, 0, 0, 0.2);\n}\n\n.tiktok-preview-button:active {\ntransform: scale(0.98);\n}\n\n.tiktok-button-icon {\nfont-size: 24px;\n}\n\n.tiktok-button-text {\ndisplay: flex;\nflex-direction: column;\nalign-items: flex-start;\ngap: 4px;\n}\n\n.tiktok-button-subtitle {\nfont-size: 14px;\nopacity: 0.8;\nfont-weight: normal;\n}\n\n/* Modal styles */\n.tiktok-modal {\ndisplay: none;\nposition: fixed;\ntop: 0;\nleft: 0;\nwidth: 100%;\nheight: 100%;\nbackground: rgba(0, 0, 0, 0.8);\nz-index: 1000;\nopacity: 0;\ntransition: opacity 0.3s ease;\n}\n\n.tiktok-modal.active {\ndisplay: flex;\njustify-content: center;\nalign-items: center;\nopacity: 1;\n}\n\n.tiktok-modal-content {\nbackground: white;\npadding: 20px;\nborder-radius: 12px;\nposition: relative;\ntransform: scale(0.7);\ntransition: transform 0.3s ease;\nopacity: 0;\nwidth: 90vw; /* Utilise 90% de la largeur du viewport */\nmax-width: 500px; /* Limite la largeur maximale */\nmin-height: 300px;\n\n/* Ajustement pour le viewport à 1100px */\n@media screen and (min-width: 1100px) {\n  width: 450px; /* Taille fixe pour les grands écrans */\n}\n\n/* Ajustement pour les très petits écrans */\n@media screen and (max-width: 480px) {\n  width: 95vw;\n  padding: 15px;\n}\n}\n\n/* Ajustement de la taille du conteneur TikTok embed */\n.tiktok-embed-container {\nwidth: 100%;\ndisplay: flex;\njustify-content: center;\n}\n\n.tiktok-embed-container .tiktok-embed {\nmargin: 0 auto !important;\nwidth: 100% !important;\nmax-width: none !important;\n}\n\n.tiktok-modal.active .tiktok-modal-content {\ntransform: scale(1);\nopacity: 1;\n}\n\n@keyframes popin {\n0% {\n  transform: scale(0.7);\n  opacity: 0;\n}\n50% {\n  transform: scale(1.05);\n  opacity: 1;\n}\n100% {\n  transform: scale(1);\n  opacity: 1;\n}\n}\n\n.tiktok-modal.active .tiktok-modal-content {\nanimation: popin 0.5s ease-out forwards;\n}\n\n.tiktok-close-button {\nposition: absolute;\ntop: -40px;\nright: -40px;\nwidth: 36px;\nheight: 36px;\nbackground: white;\nborder: none;\nborder-radius: 50%;\ncursor: pointer;\ndisplay: flex;\nalign-items: center;\njustify-content: center;\nfont-size: 20px;\ncolor: #333;\ntransition: transform 0.2s ease;\n\n/* Ajustement pour mobile */\n@media screen and (max-width: 480px) {\n  top: -50px;\n  right: 50%;\n  transform: translateX(50%);\n}\n}\n\n.tiktok-close-button:hover {\ntransform: rotate(90deg);\n\n/* Ajustement pour mobile */\n@media screen and (max-width: 480px) {\n  transform: translateX(50%) rotate(90deg);\n}\n}\n\n/* Styles pour les conteneurs de players TikTok */\n.tiktok-player-container {\nwidth: 100%;\ndisplay: flex;\njustify-content: center;\nmin-height: 300px;\n}\n`;document.head.appendChild(style)}}class TriggerService{constructor(playerService,modalService){this.playerService=playerService;this.modalService=modalService;this.triggers=[]}initFromSelector(selector,options={}){const elements=document.querySelectorAll(selector);elements.forEach((element=>{this.addTrigger(element,options)}))}addTrigger(element,options={}){const videoUrl=element.dataset.videoUrl;const targetSelector=element.dataset.target;const useModal=element.dataset.useModal==="true"||options.useModal;const title=element.dataset.title||options.title||"Voir la vidéo";const subtitle=element.dataset.subtitle||options.subtitle||"Sur TikTok";if(!videoUrl){console.warn("Trigger sans URL vidéo spécifiée",element);return}if(options.createButton!==false){const button=this._createPreviewButton(title,subtitle);element.appendChild(button)}element.addEventListener("click",(event=>{event.preventDefault();if(useModal){const modal=this.modalService.createModal();this.modalService.openModal(videoUrl,modal,options.playerOptions)}else if(targetSelector){const targetElement=document.querySelector(targetSelector);if(targetElement){this.playerService.createPlayer(videoUrl,targetElement,{clearTarget:options.clearTarget!==false,...options.playerOptions})}else{console.warn(`Élément cible non trouvé: ${targetSelector}`)}}else{console.warn("Aucune cible spécifiée pour le trigger",element)}}));this.triggers.push({element:element,videoUrl:videoUrl,targetSelector:targetSelector,useModal:useModal})}_createPreviewButton(title,subtitle){const button=document.createElement("button");button.className="tiktok-preview-button";button.innerHTML=`\n<span class="tiktok-button-icon">\n  <i class="fab fa-tiktok"></i>\n</span>\n<span class="tiktok-button-text">\n  <span>${title}</span>\n  <span class="tiktok-button-subtitle">${subtitle}</span>\n</span>\n`;return button}}class TikTokEmbed{constructor(options={}){this.version="2.0.0";this._options={selector:".tiktok-embed-trigger",modalAnimation:true,autoplayOnOpen:true,useModalByDefault:true,autoInit:true,...options};this.apiService=new TikTokAPIService;this.playerService=new TikTokPlayerService(this.apiService);this.modalService=new ModalService(this.playerService);this.triggerService=new TriggerService(this.playerService,this.modalService);if(options.autoInit!==false){this.init()}}init(){this.triggerService.initFromSelector(this._options.selector,{useModal:this._options.useModalByDefault,clearTarget:this._options.clearTargetByDefault,playerOptions:{width:this._options.playerWidth,minWidth:this._options.playerMinWidth}})}createPlayer(videoUrl,target,options={}){const targetElement=typeof target==="string"?document.querySelector(target):target;if(!targetElement){return Promise.reject(new Error("Élément cible non trouvé"))}return this.playerService.createPlayer(videoUrl,targetElement,options)}openInModal(videoUrl,options={}){const modal=this.modalService.createModal(options);return this.modalService.openModal(videoUrl,modal,options).then((()=>modal))}clearTarget(target){const targetElement=typeof target==="string"?document.querySelector(target):target;if(targetElement){this.playerService.clearTarget(targetElement)}}addTrigger(element,options={}){this.triggerService.addTrigger(element,options)}getActivePlayerInfo(){return this.playerService.getActivePlayerInfo()}}